@page "{id:int}"
@model GroupProject.Pages.BatteryListings.DetailsModel
@using BLL.Constants
@{
    ViewData["Title"] = "Chi ti·∫øt tin pin";
}

<div class="page-header">
    <h1>Chi ti·∫øt tin pin</h1>
    <a class="btn btn-link" href="@Model.ReturnUrl">
        <i class="bi bi-arrow-left"></i> Quay l·∫°i danh s√°ch
    </a>
</div>

@if (!string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}

@if (Model.Listing is not null)
{
    <div class="card-modern mb-4">
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="d-flex align-items-center gap-3 mb-3">
                    <span class="listing-icon">üîã</span>
                    <div>
                        <h2 class="h4 text-success mb-1">@Model.Listing.Brand @Model.Listing.BatteryType</h2>
                        <div class="badge bg-light text-success fw-semibold px-3 py-2">
                            @Model.FormatStatus(Model.Listing.Status)
                        </div>
                    </div>
                </div>
                <dl class="row mb-0">
                    <dt class="col-sm-5">Ng∆∞·ªùi ƒëƒÉng</dt>
                    <dd class="col-sm-7">@Model.Listing.SellerName</dd>

                    <dt class="col-sm-5">Email li√™n h·ªá</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.SellerEmail) ? "‚Äî" : Model.Listing.SellerEmail)</dd>

                    <dt class="col-sm-5">S·ªë ƒëi·ªán tho·∫°i</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.SellerPhoneNumber) ? "‚Äî" : Model.Listing.SellerPhoneNumber)</dd>

                    <dt class="col-sm-5">Lo·∫°i pin</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.BatteryType) ? "‚Äî" : Model.Listing.BatteryType)</dd>

                    <dt class="col-sm-5">Th∆∞∆°ng hi·ªáu</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.Brand) ? "‚Äî" : Model.Listing.Brand)</dd>

                    <dt class="col-sm-5">Dung l∆∞·ª£ng</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.Capacity) ? "‚Äî" : Model.Listing.Capacity)</dd>

                    <dt class="col-sm-5">ƒêi·ªán √°p</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.Voltage) ? "‚Äî" : Model.Listing.Voltage)</dd>

                    <dt class="col-sm-5">T√¨nh tr·∫°ng</dt>
                    <dd class="col-sm-7">@(string.IsNullOrWhiteSpace(Model.Listing.Condition) ? "‚Äî" : Model.Listing.Condition)</dd>

                    <dt class="col-sm-5">S·ª©c kh·ªèe (%)</dt>
                    <dd class="col-sm-7">@(Model.Listing.HealthPercentage.HasValue ? Model.Listing.HealthPercentage.Value.ToString("N0") : "‚Äî")</dd>

                    <dt class="col-sm-5">Gi√° ƒë·ªÅ xu·∫•t</dt>
                    <dd class="col-sm-7">@Model.Listing.Price.ToString("N0") ƒë</dd>

                    <dt class="col-sm-5">Ng√†y g·ª≠i</dt>
                    <dd class="col-sm-7">@(Model.Listing.SubmittedDate.HasValue ? Model.Listing.SubmittedDate.Value.ToLocalTime().ToString("dd/MM/yyyy HH:mm") : "‚Äî")</dd>

                    <dt class="col-sm-5">Ng√†y duy·ªát</dt>
                    <dd class="col-sm-7">@(Model.Listing.ApprovedDate.HasValue ? Model.Listing.ApprovedDate.Value.ToLocalTime().ToString("dd/MM/yyyy HH:mm") : "‚Äî")</dd>

                    <dt class="col-sm-5">Ng√†y ƒëƒÉng</dt>
                    <dd class="col-sm-7">@(Model.Listing.PublishedDate.HasValue ? Model.Listing.PublishedDate.Value.ToLocalTime().ToString("dd/MM/yyyy HH:mm") : "‚Äî")</dd>
                </dl>
            </div>
            <div class="col-lg-6">
                @if (!string.IsNullOrEmpty(Model.Listing.ImageUrl))
                {
                    <img src="@Model.Listing.ImageUrl" alt="·∫¢nh pin" class="img-fluid rounded-4 shadow-sm w-100" />
                }
                else
                {
                    <div class="border border-dashed rounded-4 text-center p-5 text-muted">
                        Ch∆∞a c√≥ h√¨nh ·∫£nh
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="card-modern mb-4">
        <h3 class="h5 mb-3">M√¥ t·∫£ chi ti·∫øt</h3>
        <p class="mb-4">@(string.IsNullOrWhiteSpace(Model.Listing.Description)
            ? "Ng∆∞·ªùi ƒëƒÉng ch∆∞a cung c·∫•p m√¥ t·∫£."
            : Model.Listing.Description)</p>

        @if (Model.IsOwner && !string.IsNullOrEmpty(Model.Listing.ModerationNote))
        {
            <div class="alert alert-warning mb-0">
                <strong>Ghi ch√∫ t·ª´ qu·∫£n tr·ªã vi√™n:</strong>
                <div>@Model.Listing.ModerationNote</div>
            </div>
        }
    </div>

    @* N√∫t Mua ngay cho buyer *@
    @if (Model.CanPurchase)
    {
        <div class="card-modern mb-4">
            <div class="text-center">
                <h3 class="h4 mb-3">@Model.Listing.Price.ToString("N0") ƒë</h3>
                <a asp-page="/Buyer/Orders/Create" 
                   asp-route-itemType="Battery" 
                   asp-route-itemId="@Model.Listing.BatteryId" 
                   class="btn btn-primary btn-lg">
                    <i class="bi bi-cart-plus"></i> Mua ngay
                </a>
            </div>
        </div>
    }

    @* Reviews c·ªßa seller *@
    @if (Model.SellerReviews.Any())
    {
        <div class="card-modern mb-4">
            <h3 class="h5 mb-3">
                <i class="bi bi-star-fill text-warning"></i> 
                ƒê√°nh gi√° c·ªßa ng∆∞·ªùi b√°n (@Model.SellerReviews.Count)
            </h3>
            <div class="review-list">
                @foreach (var review in Model.SellerReviews)
                {
                    <div class="review-item border-bottom pb-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <strong>@(review.Reviewer?.FullName ?? "Ng∆∞·ªùi d√πng ·∫©n danh")</strong>
                                <div class="text-muted small">
                                    @review.CreatedDate?.ToString("dd/MM/yyyy HH:mm")
                                </div>
                            </div>
                            <div class="rating">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    if (i <= review.Rating)
                                    {
                                        <span class="text-warning"><i class="bi bi-star-fill"></i></span>
                                    }
                                    else
                                    {
                                        <span class="text-muted"><i class="bi bi-star"></i></span>
                                    }
                                }
                            </div>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(review.Comment))
                        {
                            <p class="mb-0">@review.Comment</p>
                        }
                    </div>
                }
            </div>
        </div>
    }
    else if (Model.Listing.Status == ListingStatus.Approved)
    {
        <div class="card-modern mb-4">
            <div class="text-muted text-center py-3">
                <i class="bi bi-star"></i> Ch∆∞a c√≥ ƒë√°nh gi√° n√†o cho ng∆∞·ªùi b√°n n√†y.
            </div>
        </div>
    }
}
else if (string.IsNullOrEmpty(Model.ErrorMessage))
{
    <div class="alert alert-warning">Kh√¥ng t√¨m th·∫•y tin ƒëƒÉng.</div>
}



